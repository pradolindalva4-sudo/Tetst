<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DONY BURGUERS - VENDEDOR v13.8</title>
    <!-- FIREBASE CORE -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { 
            --gold-18k: linear-gradient(145deg, #bf953f 0%, #fcf6ba 20%, #b38728 40%, #fcf6ba 60%, #aa771c 80%, #fcf6ba 100%);
            --gold-solid: #d4af37;
        }
        body { 
            background: #000; color: var(--gold-solid); font-family: 'Arial Black', sans-serif; 
            margin: 0; padding: 110px 2% 120px 2%; user-select: none;
        }
        .header { 
            position: fixed; top: 0; left: 0; right: 0; height: 95px; 
            background: #000; border-bottom: 3px solid var(--gold-solid); z-index: 1000; padding: 0 5%;
            display: flex; justify-content: space-between; align-items: center;
        }
        #total-display { font-size: 28px; font-weight: 900; color: #fff; }
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .card { 
            background: #050505; border: 1px solid #1a1a1a; border-radius: 12px; 
            overflow: hidden; position: relative; height: 200px;
        }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.85); padding: 5px 0; text-align: center; }
        .btn-confirmar { 
            position: fixed; bottom: 20px; left: 5%; width: 90%; 
            background: var(--gold-18k); color: #000; padding: 20px; border: none; 
            border-radius: 15px; font-weight: 900; font-size: 1.6rem; z-index: 1100; 
        }
        #escritorio-jdp { display: none; position: fixed; inset: 0; background: #000; z-index: 10000; padding: 20px; overflow-y: auto; }
    </style>
</head>
<body>

    <div class="header">
        <div onclick="contarCliques()">
            <div style="font-size:9px;">JDP KERNEL v13.8</div>
            <div style="font-size:20px; color:#fcf6ba;">DONY BURGUERS</div>
        </div>
        <div id="total-display">R$ 0,00</div>
    </div>

    <div class="grid-container" id="vitrine"></div>

    <button class="btn-confirmar" onclick="finalizarPedido()">ENVIAR PARA COZINHA</button>

    <!-- PAINEL ADMINISTRATIVO -->
    <div id="escritorio-jdp">
        <h2 style="color:var(--gold-solid)">CADASTRO DE PRODUTOS</h2>
        <input type="text" id="inp-nome" placeholder="Nome" style="width:100%; padding:10px; margin:5px 0;">
        <input type="number" id="inp-preco" placeholder="Preço" style="width:100%; padding:10px; margin:5px 0;">
        <input type="file" id="inp-file" accept="image/*" style="margin:10px 0;">
        <button onclick="salvarProduto()" style="width:100%; padding:15px; background:var(--gold-18k); font-weight:900;">GRAVAR</button>
        <button onclick="document.getElementById('escritorio-jdp').style.display='none'" style="width:100%; padding:10px; margin-top:20px;">VOLTAR</button>
    </div>

<script>
    // CONFIGURAÇÃO FIREBASE (IGUAL À SUA COMANDA)
    const firebaseConfig = { 
        apiKey: "AIzaSyCEdXF7ScnMYz0Ce0OW-B_UJ8Bm5Pl9m8o", 
        databaseURL: "https://dony-burguers-default-rtdb.firebaseio.com" 
    };
    firebase.initializeApp(firebaseConfig);
    const rtdb = firebase.database();

    var db;
    var carrinho = [];
    var cliques = 0;
    var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // SOM DE ALERTA (PARA O CABO P2)
    function bipCozinha() {
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.setValueAtTime(1000, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.5);
    }

    // BANCO LOCAL (INDEXEDDB)
    var request = indexedDB.open("JDP_Industrial_DB", 5);
    request.onupgradeneeded = (e) => {
        var d = e.target.result;
        if(!d.objectStoreNames.contains("produtos")) d.createObjectStore("produtos", { keyPath: "id", autoIncrement: true });
    };
    request.onsuccess = (e) => { db = e.target.result; renderizarVitrine(); };

    function contarCliques() {
        cliques++;
        if(cliques >= 3) {
            if(prompt("SENHA JDP:") === "drkling2025") document.getElementById('escritorio-jdp').style.display='block';
            cliques = 0;
        }
    }

    function salvarProduto() {
        var n = document.getElementById('inp-nome').value;
        var p = document.getElementById('inp-preco').value;
        var f = document.getElementById('inp-file').files[0];
        var reader = new FileReader();
        reader.onload = (ev) => {
            var img = new Image();
            img.onload = () => {
                var canvas = document.createElement('canvas');
                canvas.width = 300; canvas.height = 300;
                canvas.getContext('2d').drawImage(img, 0, 0, 300, 300);
                db.transaction("produtos", "readwrite").objectStore("produtos").add({
                    nome: n, preco: parseFloat(p), imagem: canvas.toDataURL('image/jpeg', 0.6)
                }).oncomplete = () => { alert("OK!"); location.reload(); };
            };
            img.src = ev.target.result;
        };
        reader.readAsDataURL(f);
    }

    function renderizarVitrine() {
        var v = document.getElementById('vitrine');
        v.innerHTML = "";
        db.transaction("produtos").objectStore("produtos").openCursor().onsuccess = (e) => {
            var cursor = e.target.result;
            if(cursor) {
                var p = cursor.value;
                var card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => { carrinho.push(p); atualizarTotal(); };
                card.innerHTML = `<img src="${p.imagem}"><div class="card-info"><b>${p.nome}</b><br>R$ ${p.preco.toFixed(2)}</div>`;
                v.appendChild(card);
                cursor.continue();
            }
        };
    }

    function atualizarTotal() {
        var t = 0;
        carrinho.forEach(i => t += i.preco);
        document.getElementById('total-display').innerHTML = "R$ " + t.toFixed(2);
    }

    function finalizarPedido() {
        if(carrinho.length === 0) return;

        // 1. TOCA O BIP (VIA CABO P2)
        bipCozinha();

        // 2. FORMATA PARA O PADRÃO DA SUA COMANDA
        const pedidoParaCozinha = {
            data: new Date().toLocaleString('pt-BR'),
            total: document.getElementById('total-display').innerHTML,
            itens: carrinho.map(item => ({ nome: item.nome }))
        };

        // 3. ENVIA PARA O FIREBASE (PRECISA DE UMA "GOTA" DE INTERNET)
        rtdb.ref('PEDIDOS_PRODUCAO').push(pedidoParaCozinha)
        .then(() => {
            alert("PEDIDO ENVIADO À COZINHA!");
            carrinho = [];
            atualizarTotal();
        })
        .catch((err) => {
            alert("ERRO: SEM INTERNET! O pedido não subiu para a tela, mas o som tocou.");
        });
    }
</script>
</body>
</html>
